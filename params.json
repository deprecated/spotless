{"name":"Spotless","tagline":"Remove cosmic rays and other artefacts from astronomical images","body":"<div id=\"table-of-contents\">\r\n<h2>Table of Contents</h2>\r\n<div id=\"text-table-of-contents\">\r\n<ul>\r\n<li><a href=\"#sec-1\">1. spotless.py</a>\r\n<ul>\r\n<li><a href=\"#sec-1-1\">1.1. Compatibility and dependencies</a></li>\r\n<li><a href=\"#sec-1-2\">1.2. Installation</a></li>\r\n<li><a href=\"#sec-1-3\">1.3. Usage</a>\r\n<ul>\r\n<li><a href=\"#sec-1-3-1\">1.3.1. File handling</a></li>\r\n<li><a href=\"#sec-1-3-2\">1.3.2. Specifying the pixel-rejection method to use</a></li>\r\n<li><a href=\"#sec-1-3-3\">1.3.3. Pruning the list of bad pixel objects</a></li>\r\n<li><a href=\"#sec-1-3-4\">1.3.4. Manually excluding and including regions</a></li>\r\n<li><a href=\"#sec-1-3-5\">1.3.5. Which images are saved</a></li>\r\n<li><a href=\"#sec-1-3-6\">1.3.6. Examples</a></li>\r\n</ul>\r\n</li>\r\n<li><a href=\"#sec-1-4\">1.4. Command line reference</a></li>\r\n</ul>\r\n</li>\r\n</ul>\r\n</div>\r\n</div>\r\n\r\n# spotless.py<a id=\"sec-1\" name=\"sec-1\"></a>\r\n\r\nA python program for removing cosmic rays, stitching artifacts, and (optionally) stars from an astronomical image or spectrum\r\n\r\nThe cosmic ray removal process has three stages:\r\n\r\n1.  Pixel rejection and grouping contiguous bad pixel regions into \"objects\"\r\n2.  Pruning the list of objects in order to minimise false positives\r\n3.  \"Zapping\" all the pixels in each object in the final list by replacing bad pixels by the average of the \"good\" neighbors\r\n\r\n## Compatibility and dependencies<a id=\"sec-1-1\" name=\"sec-1-1\"></a>\r\n\r\nSpotless has been tested on Python 2.7, 3.3, and 3.4. \r\n\r\nIt depends on the following third-party libraries:\r\n\r\n-   [Numpy](http://www.numpy.org) and [Scipy](http://www.scipy.org/install.html)\r\n    -   If you are using a full-featured scientific python distribution such as [Anaconda](http://continuum.io/downloads.html) then you already have these.\r\n-   [Scikits Image](http://scikit-image.org)\r\n    -   `conda install scikits-image`\r\n-   Either [Astropy](http://www.astropy.org) (recommended) or PyFITS (no longer maintained)\r\n    -   `conda install astropy`\r\n-   [Pyregion](https://pypi.python.org/pypi/pyregion)\r\n    -   `pip install pyregion`\r\n    -   At time of writing (27 Nov 2014) this is not available in the Anaconda repository, but it can be installed from the Python Package Index using `pip` or `easy_install`\r\n\r\n## Installation<a id=\"sec-1-2\" name=\"sec-1-2\"></a>\r\n\r\nSpotless consists of a single python script `spotless.py` that you can either copy to somewhere on your python path (or your working directory), or just leave it where it is, in which case you will have to specify the full path every time you run it.\r\n\r\n## Usage<a id=\"sec-1-3\" name=\"sec-1-3\"></a>\r\n\r\nBasic usage: \r\n\r\n    python spotless.py INPUT_FILE\r\n\r\nwhere `INPUT_FILE` is the name (without the `.fits` suffix) of the FITS file that you want to process.  An output file named `INPUT_FILE-cr.fits` will be produced.  \r\n\r\n### File handling<a id=\"sec-1-3-1\" name=\"sec-1-3-1\"></a>\r\n\r\nBy default, spotless will process the HDU named `SCI` in the input\r\nfile if it is found, otherwise the first HDU will be used.  A\r\ndifferent HDU may be specified by using the `--hdu-name` option.\r\n\r\nThe extra string that is added to the name of the output file (default: `cr`) may be changed using the `--output-id` option.\r\n\r\n### Specifying the pixel-rejection method to use<a id=\"sec-1-3-2\" name=\"sec-1-3-2\"></a>\r\n\r\nThree different methods are available for choosing which pixels to reject.  In all cases, the result is a list of candidate \"bad pixel objects\", each of which is a contiguous region of pixels that are deemed to be bad.  This list is then pruned according to additional criteria discussed below to give a final list of bad pixel objects. \r\n\r\n1.  Simple threshold\r\n\r\n    This method simply rejects all pixels with values greater than a certain value.  \r\n    To use *only* this method, specify the options `--method thresh --threshold VALUE` where `VALUE` is the value of the threshold.   The option `--threshold VALUE` can also be used at the same time as another method, in which case the two methods are combined. \r\n\r\n2.  Edge detection followed by hole filling\r\n\r\n    This is currently the default method so no option is required, but it can also be explicitly selected with `--method edge=`.  The option `--data-range MIN MAX` should be used to specify the approximate minimum and maximum values of the image brightness.  There is also an option `--use-log-scale`, which sometimes improves the results for images with a large dynamic range.  \r\n\r\n3.  Segmentation via watershed transform of the elevation map\r\n\r\n    This method does not seem to work very well, and so is not recommended.  If you want to try it anyway, the option `--method segment` should be specified. \r\n\r\n### Pruning the list of bad pixel objects<a id=\"sec-1-3-3\" name=\"sec-1-3-3\"></a>\r\n\r\nThe pixel-rejection methods all tend to produce a large number of false positives.  Many of these can be effectively pruned with a few simple criteria.  Each candidate object is checked to make sure it is sufficiently small, sufficiently circular, and not a dark region.  The details of these checks can be controlled with the options `--dmax`, `--ddmax`, `--reject-filaments`, and `--allow-shadows`.  See the Command line reference (See section 1.4) below for details. \r\n\r\n### Manually excluding and including regions<a id=\"sec-1-3-4\" name=\"sec-1-3-4\"></a>\r\n\r\nThe option `--exclude-regions-from-file FILENAME.reg` allows you to specify a DS9 region file for exclusion from the algorithm.  All regions in this file will be marked as \"good\".  That is, no cosmic ray detection will be performed inside the regions.  It is often necessary to use this option to protect known stars in your image (unless you want the stars to be zapped). \r\n\r\nContrariwise, the option `--include-regions-from-file FILENAME.reg` allows you to specify known \"bad\" regions.  All regions in this file will be automatically added to the final list of bad pixel objects to be zapped.  \r\n\r\n### Which images are saved<a id=\"sec-1-3-5\" name=\"sec-1-3-5\"></a>\r\n\r\nBy default, the `SCI` HDU in the output file has had all its final bad pixels zapped (but if the option `--only-bad-pix` is specified then it is just copied through unchanged from the input file).  A further HDU named `badpix` is  written to the output file, which is a logical mask of the pixels that were zapped. Any additional HDUs in the input file are copied through unchanged. \r\n\r\nIf the option `--debug` is specified then several extra image HDUs are saved to the output file.  It the case of the `edge` method these are: `scaled`, `edges`, `candidates`, and `labels`. \r\n\r\nIn addition, a file `INPUT_FILE-objects.tab` is written with a table that lists the label number (corresponding to the `labels` image), sizes, and pruning criteria for all the candidate bad pixel objects. \r\n\r\n### Examples<a id=\"sec-1-3-6\" name=\"sec-1-3-6\"></a>\r\n\r\n    python spotless.py  --data-range 0 10.0 --allow-shadows --output-id cr --verbose --debug F547M\r\n\r\n## Command line reference<a id=\"sec-1-4\" name=\"sec-1-4\"></a>\r\n\r\n\r\n    python spotless.py --help\r\n\r\n    usage: spotless.py [-h] [--hdu-name HDU_NAME] [--output-id OUTPUT_ID]\r\n                       [--method {thresh,edge,segment}] [--onlybadpix]\r\n                       [--threshold THRESHOLD] [--dmax DMAX] [--ddmax DDMAX]\r\n                       [--data-range MIN MAX] [--use-log-scale]\r\n                       [--segment-pars LO HI]\r\n                       [--edge-pars SIGMA LOW_THRESHOLD HIGH_THRESHOLD]\r\n                       [--thick-edges] [--reject-filaments] [--allow-shadows]\r\n                       [--clip-negative]\r\n                       [--exclude-regions-from-file EXCLUDE_REGIONS_FROM_FILE]\r\n                       [--include-regions-from-file INCLUDE_REGIONS_FROM_FILE]\r\n                       [--verbose] [--debug] [--multi-hdu]\r\n                       fitsfile\r\n    \r\n    Remove cosmic rays and other bad pixels from an image\r\n    \r\n    positional arguments:\r\n      fitsfile              Name of input image FITS file (sans extension)\r\n    \r\n    optional arguments:\r\n      -h, --help            show this help message and exit\r\n      --hdu-name HDU_NAME   Which HDU to use from the FITS file (default: SCI)\r\n      --output-id OUTPUT_ID\r\n                            Extra string to add to output filename to\r\n                            differentiate from the input file (default: cr)\r\n      --method {thresh,edge,segment}\r\n                            Algorithm to use to find the bad pixels (default:\r\n                            edge)\r\n      --onlybadpix          Only calculate the bad pixel map - do not replace\r\n                            pixels in the image (default: False)\r\n      --threshold THRESHOLD\r\n                            Assume any pixel above this level is bad (default:\r\n                            None)\r\n      --dmax DMAX           Maximum diameter of features to zap. Leave alone any\r\n                            roughly circular objects that are larger than this.\r\n                            (default: 5)\r\n      --ddmax DDMAX         Absolute maximum diameter of features to zap. Leave\r\n                            alone any objects that are larger than this, whatever\r\n                            their shape may be. (default: 10)\r\n      --data-range MIN MAX  Range for data scaling (default: None)\r\n      --use-log-scale       Use logarithmic data scaling (default: False)\r\n      --segment-pars LO HI  For 'segment' method only: thresholds of scaled data\r\n                            to seed the good/bad regions (default: (0.0, 1.0))\r\n      --edge-pars SIGMA LOW_THRESHOLD HIGH_THRESHOLD\r\n                            For 'edge' method only: parameters for the Canny edge\r\n                            detection algorithm. See: http://scikits-\r\n                            image.org/docs/dev/auto_examples/plot_canny.html\r\n                            (default: (1.0, 0.1, 0.2))\r\n      --thick-edges         Make the edges be 3 pixels wide instead of the default\r\n                            1 (default: False)\r\n      --reject-filaments    Try to reject objects that look filamentary, since\r\n                            they are probably not cosmic rays (default: False)\r\n      --allow-shadows       Also remove objects that are darker than their\r\n                            surroudings (not generally advised, especially if you\r\n                            have dark globules in your image!) (default: False)\r\n      --clip-negative       Also remove all negative pixels (default: False)\r\n      --exclude-regions-from-file EXCLUDE_REGIONS_FROM_FILE\r\n                            Read DS9 regions from a file, which are to be marked\r\n                            as definite good pixels (default: None)\r\n      --include-regions-from-file INCLUDE_REGIONS_FROM_FILE\r\n                            Read DS9 regions from a file, which are to be marked\r\n                            as definite bad pixels (default: None)\r\n      --verbose, -v         Print informative progress messages (default: False)\r\n      --debug, -d           Save auxiliary images of intermediate steps (default:\r\n                            False)\r\n      --multi-hdu, -m       Only provided for backward compatibility - this\r\n                            behavior is now the default. Work in multi-HDU mode.\r\n                            This assumes that the image is in the \"SCI\" HDU in the\r\n                            input file (the argument --hdu-index is ignored). All\r\n                            additional HDUs in the input file are copied through\r\n                            to the output file. Only one output file is written,\r\n                            all auxilliary arrays (\"edges\", \"labels\", \"badpix\",\r\n                            etc) are written as additional HDUs in the same file.\r\n                            (default: True)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}